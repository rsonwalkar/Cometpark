<!--<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple markers</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
function initialize() {
  var myLatlng1 = new google.maps.LatLng(32.990616, -96.745397);
  var myLatlng2 = new google.maps.LatLng(32.990215, -96.745563);
  var mapOptions1 = {
    zoom: 100,
    center: myLatlng1
  }
  var mapOptions2 = {
    zoom: 100,
    center: myLatlng2
  }
  var map1 = new google.maps.Map(document.getElementById('map-canvas'), mapOptions1);
  var map2 = new google.maps.Map(document.getElementById('map-canvas'), mapOptions2);

  var marker1 = new google.maps.Marker({
      //position: myLatlng,
      position: myLatlng1,
      map: map1,
      title: 'Spot A'
  });
  var marker2 = new google.maps.Marker({
      //position: myLatlng,
      position: myLatlng2,
      map: map2,
      title: 'Spot B'
  });
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>-->
<!DOCTYPE html>
    <html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
      <title>Parking Lot A Status</title>
      <style>
      html, body, #map {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
      <script src="//code.jquery.com/jquery-1.10.2.js"></script>
      <script src="http://maps.google.com/maps/api/js?sensor=false"
              type="text/javascript"></script>
    </head>
    <body>
      <div id="map"></div>

      <script type="text/javascript">

       var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 18,
          center: new google.maps.LatLng(32.9904737,-96.7452652),//32.9904199,-96.7451339
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          rotateControl: false,
          zoomControl: false
        });
       var lotcoordinates = [
    new google.maps.LatLng(32.990019, -96.746751),
    new google.maps.LatLng(32.989466, -96.746875),
    new google.maps.LatLng(32.988953, -96.746472),
    new google.maps.LatLng(32.990213, -96.744246),
    new google.maps.LatLng(32.990676, -96.744074),
    new google.maps.LatLng(32.991621, -96.744740),
    new google.maps.LatLng(32.991860, -96.745233),
    new google.maps.LatLng(32.990019, -96.746751),
  ];
  // Construct the polygon.
  parkinglot = new google.maps.Polygon({
    paths: lotcoordinates,
    strokeColor: '#FF0000',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: 'yellow',
    fillOpacity: 0.35
  });
  parkinglot.setMap(map);

      lotAstatus()
      function lotAstatus(){
      var parkingspots = [];
      $.ajax({
        type: 'GET',
        datatype: 'json',
        contentType: 'application/json; charset=utf-8',
        url: 'http://rohitsonwalkar.com:4242/getstatus/A',
        success: function(data) {   
          
            //console.log('Lot C status:' + data);
            // Loop to fetch details of each parking spot for parking lot A
            
            $.each(data, function(id, status) {
              parkingspots.push({});
              parkingspots[id].pid = data[id].pid;
              parkingspots[id].pstatus = data[id].pstatus;
              parkingspots[id].lat = data[id].lat;
              parkingspots[id].longitude = data[id].longitude;
              parkingspots[id].permit = data[id].permit;
              console.log('Data in parkingspots: ', parkingspots[id].pid, ' ', parkingspots[id].pstatus, ' ', parkingspots[id].lat, ' ', parkingspots[id].longitude, ' ', parkingspots[id].permit);

            

          });
        var infowindow = new google.maps.InfoWindow();

        var marker;
        var markers = [];
        var markerBounds = new google.maps.LatLngBounds();
        var spotposition;
        //for (i = 0; i < locations.length; i++) {
          for (var i = 0; i < parkingspots.length; i++) {
            console.log(parkingspots[i].pid, ' ', parkingspots[i].pstatus, ' ', parkingspots[i].lat);
            if(parkingspots[i].pstatus == 'vacant') {
                var image = 'http://maps.google.com/mapfiles/ms/icons/green-dot.png';
                console.log('In vacant: '+ image);  
              } else if(parkingspots[i].pstatus == 'occupied') {
                var image ='http://maps.google.com/mapfiles/ms/icons/red-dot.png';  
              }
              //var contentString = '<p>Permit: Green</p>';
              var contentString = '<p>Permit: '+parkingspots[i].permit+'</p>';
              spotposition = new google.maps.LatLng(parkingspots[i].lat, parkingspots[i].longitude);
          marker = new google.maps.Marker({
            position: spotposition,
            map: map,
            icon: image,
            title: parkingspots[i].pid
          });
          markers.push(marker);

          google.maps.event.addListener(marker, 'click', (function(marker, i, contentString) {
            return function() {
              infowindow.setContent(contentString);
              infowindow.open(map, marker);
            }
          })(marker,i, contentString)); 
          markerBounds.extend(spotposition);
        }
        
        // Deleting all the markers from the map
        /*for(var i=0; i<markers.length; i++) {
          console.log('Deleting marker');
          markers[i].setMap(null);
        }*/
      }
      });
        
        
       } 
       setInterval(lotAstatus, 5000);
      </script>
    </body>
    </html>
